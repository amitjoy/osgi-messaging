sourceCompatibility = '1.8'
targetCompatibility = '1.8'

tasks.named("release") {
    doFirst {
        // Create the directory Bnd is complaining about
        mkdir("${rootDir}/cnf/cache/sonatype-release")
    }
}
// Define a task that explicitly empties the folder
tasks.register("clearSonatypeStaging") {
    doFirst {
        // Point to your actual staging location
        def stagingDir = file("${rootDir}/cnf/target/sonatype-staging")
        
        if (stagingDir.exists()) {
            println "ðŸ§¹ Cleaning Staging Directory: ${stagingDir}"
            // Deletes the CONTENTS, but keeps the folder
            stagingDir.listFiles()?.each { it.deleteDir() } 
        } else {
            // Ensure it exists so Bnd doesn't complain
            stagingDir.mkdirs()
        }
    }
}

// Hook it into the Release process
subprojects {
    tasks.configureEach { task ->
        if (task.name == 'release') {
            // Run 'clear' task before the release task starts
            task.dependsOn(rootProject.tasks.named("clearSonatypeStaging"))
        }
    }
}